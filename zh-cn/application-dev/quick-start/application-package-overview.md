# 应用程序包概述


在基于[Stage模型](application-configuration-file-overview-stage.md)开发应用之前，开发者需要了解应用的设计机制、应用程序包结构等基础知识。

## 应用与应用程序包

用户应用程序泛指运行在设备的操作系统之上，为用户提供特定服务的程序，简称“应用”。一个应用所对应的软件包文件，称为“应用程序包”。

当前系统提供了应用程序包开发、安装、查询、更新、卸载的管理机制，便于开发者开发和管理应用。同时，系统还屏蔽了不同的芯片平台的差异（包括x86/ARM，32位/64位等），应用程序包在不同的芯片平台都能够安装运行，这使得开发者可以聚焦于应用的功能实现。

## 应用的多Module设计机制

- **支持模块化开发：** 一个应用通常会包含多种功能，将不同的功能特性按模块来划分和管理是一种良好的设计方式。在开发过程中，我们可以将每个功能模块作为一个独立的Module进行开发，Module中可以包含源代码、资源文件、第三方库、配置文件等，每一个Module可以独立编译，实现特定的功能。这种模块化、松耦合的应用管理方式有助于应用的开发、维护与扩展。

- **支持多设备适配：** 一个应用往往需要适配多种设备类型，在采用多Module设计的应用中，每个Module都会标注所支持的设备类型。有些Module支持全部类型的设备，有些Module只支持某一种或几种型的设备（比如平板），那么在应用市场分发应用包时，也能够根据设备类型做精准的筛选和匹配，从而将不同的包合理的组合和部署到对应的设备上。

## 根据场景选择Module类型

Module按照使用场景可以分为两种类型：

- ** “Ability”类型的Module：** 用于实现应用的功能和特性。每一个“Ability”类型的Module编译后，会生成一个以.hap为后缀的文件，我们称其为HAP包。HAP包可以独立安装和运行，是应用安装的基本单位。
  一个应用中可以包含多个HAP包，在这些HAP包中，必须有且仅有一个HAP作为应用的入口。该HAP需要采用Entry类型的Ability来实现，其他HAP采用Feature类型的Ability来实现。
  - Entry类型的Ability：应用的主模块，包含应用的入口界面、入口图标和主功能特性。编译后生成Entry类型的HAP，简称为Entry。每一个应用分发到同一类型的设备上的应用程序包，只能包含唯一一个Entry。
  - Feature类型的Ability：应用的动态特性模块。编译后生成Feature类型的HAP，简称为Feature。一个应用中可以包含一个或多个Feature，也可以不含。

- ** “Library”类型的Module：** 用于实现代码和资源的共享。同一个“Library”类型的Module可以被其他的Module多次引用，合理地使用该类型的Module，能够降低开发和维护成本。“Library”类型的Module分为Static和Shared两种类型，编译后会生成共享包。
  - Static Library：静态共享库。编译后会生成一个以.har为后缀的文件，即静态共享包HAR（Harmony Archive）。
  - Shared Library：动态共享库。编译后会生成一个以.hsp为后缀的文件，即动态共享包HAR（Harmony Archive），还会生成一个.har文件，该文件包含HSP对外导出的接口。应用中的其他模块需要通过.har文件来引用HSP的功能。
  
  上述两种共享包的主要区别体现在：
  - 编译和运行方式不同：HAR中的代码和资源跟随使用方编译，如果有多个使用方，它们的编译产物中会存在多份相同拷贝；而HSP中的代码和资源可以独立编译，运行时在一个进程中代码也只会存在一份。
  - 发布和引用方式不同：HAR除了支持应用内引用，还可以独立打包发布，供其他应用引用；HSP一般随应用进行打包，当前只支持应用内引用，不支持独立发布和跨应用的引用。

**图1** HAR和HSP在APP包中的形态示意图
![in-app-hsp-har](figures/in-app-hsp-har.png)

为了便于开发者根据场景选择适合的Module进行开发，总结对比如下：

| Module类型（开发态） | 包的类型（编译态） | 说明 | 
| -------- | -------- | -------- | 
| **Ability类型** | HAP | 承载应用的功能和特性，是应用安装和运行的基本单元。| 
| - Entry类型的Ability | HAP| 作为应用的主模块，实现应用入口的功能特性。同一类设备有且只有一个。| 
| - Feature类型的Ability | HAP| 作为应用的特性模块，实现除Entry以外的功能特性。 | 
| **Library类型** | HAR/HSP | 共享代码和资源，不能独立安装运行在设备上，只能作为应用的依赖项被引用。 | 
| - Static Library | HAR | - 支持应用内共享，也可以发布后供其他应用使用。<br/> &ensp; - 作为二方库，发布到OPHM私仓，供公司内部其他应用使用。<br/> &ensp;- 作为三方库，发布到OPHM中心仓，供其他应用使用。<br/> - 多包引用相同的HAR时，会导致App包膨大。 | 
| - Shared Library | HSP| - 当前仅支持应用内共享。<br/> - 当多包同时引用同一个共享包时，采用HSP替代HAR，可以避免HAR造成的多包间代码和资源的重复拷贝，从而减小应用包大小。 | 


